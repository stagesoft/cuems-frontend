<div class="wrapper">
  <app-page-header
    title="projects"
    description="Proyectos eliminados que pueden ser restaurados o eliminados permanentemente."
    icon="project"
  ></app-page-header>
</div>

<div class="wrapper">
  <div class="py-6">
    <div>
      <div class="sm:flex sm:items-center">
        <div class="sm:flex-auto">
          <div class="flex items-center mb-8">
            <a routerLink="/projects"
               routerLinkActive="font-medium"
               [routerLinkActiveOptions]="{exact: true}"
               class="pr-4 py-1 border-r"
            >
              {{ 'project.list.active' | translate }} ({{ projectsService.projects().length }})
            </a>

            <a routerLink="/projects/trash"
               class="px-4 py-1"
               routerLinkActive="font-medium"
               [routerLinkActiveOptions]="{exact: true}"
            >{{ 'project.list.trash' | translate }} ({{ projectsService.projectsInTrash().length }})</a>
          </div>

          <div class="flex gap-4">
            <button type="button" class="btn btn-small btn-muted" 
                    [disabled]="selectedProjects.length === getSelectableProjects().length" 
                    (click)="selectAllProjects()">{{ 'project.list.select.all' | translate }}</button>
            <button type="button" class="btn btn-small btn-muted" 
                    [disabled]="selectedProjects.length === 0" 
                    (click)="deselectAllProjects()">{{ 'project.list.deselect.all' | translate }}</button>
            <button type="button" class="btn btn-secondary btn-small" 
                    [disabled]="selectedProjects.length === 0 || isRestoring" 
                    (click)="openBulkRestoreConfirmation()">
              <span *ngIf="isRestoring" class="inline-block w-4 h-4 mr-1">
                <svg class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
              {{ 'project.list.restore' | translate }}
            </button>
            <button type="button" class="btn btn-tertiary btn-small" 
                    [disabled]="selectedProjects.length === 0 || isDeleting" 
                    (click)="openBulkDeleteConfirmation()">
              <span *ngIf="isDeleting" class="inline-block w-4 h-4 mr-1">
                <svg class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
              {{ 'project.list.delete' | translate }}
            </button>
          </div>          
        </div>
      </div>

      <div *ngIf="isLoading" class="flex justify-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
      </div>

      <div *ngIf="!isLoading && projectsService.projectsInTrash().length === 0" class="py-8 text-center">
        {{ 'project.list.no.projects.in.trash' | translate }}
      </div>

      <div *ngIf="!isLoading && projectsService.projectsInTrash().length > 0" class="mt-8 flow-root">
        <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
          <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
            <div class="overflow-hidden">
              <table class="min-w-full divide-y divide-gray-300">
                <thead class="">
                  <tr>
                    <th scope="col" class="w-10 py-3.5 pr-3 pl-4 text-left text-sm font-semibold sm:pl-0">
                      <input class="checkbox" type="checkbox" 
                             (click)="$event.stopPropagation(); selectAllProjects()" 
                             [checked]="selectedProjects.length === getSelectableProjects().length && getSelectableProjects().length > 0"
                             [disabled]="getSelectableProjects().length === 0">
                    </th>
                    <th scope="col" class="w-64 py-3.5 pr-3 pl-4 text-left text-sm font-semibold sm:pl-0">{{ 'project.list.name' | translate }}</th>
                    <th scope="col" class="w-40 px-3 py-3.5 text-left text-sm font-semibold">{{ 'project.list.unix_name' | translate }}</th>
                    <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-0">
                      <span class="sr-only">{{ 'project.list.actions' | translate }}</span>
                    </th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                  <tr *ngFor="let project of projectsService.projectsInTrash()" 
                      class="cursor-pointer"
                      [class.opacity-60]="isProjectBeingRestored(project.uuid) || isProjectBeingDeleted(project.uuid)">
                    <td class="w-10 whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-0">
                      <input class="checkbox" type="checkbox" 
                             [checked]="selectedProjects.includes(project.uuid)" 
                             [disabled]="isProjectBeingRestored(project.uuid) || isProjectBeingDeleted(project.uuid)"
                             (click)="$event.stopPropagation(); selectProject(project.uuid)">
                    </td>
                    <td class="w-64 whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium sm:pl-0">
                      {{ project.name }}
                    </td>
                    <td class="w-40 whitespace-nowrap px-3 py-4 text-sm">
                      {{ project.unix_name }}
                    </td>
                    <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-0">
                      <div class="flex justify-end gap-2">
                        <button
                          class="text-primary hover:text-primary-light mr-4"
                          [disabled]="isProjectBeingRestored(project.uuid) || isProjectBeingDeleted(project.uuid)"
                          (click)="$event.stopPropagation(); restoreProject(project.uuid)"
                        >
                          <span *ngIf="isProjectBeingRestored(project.uuid)" class="inline-block w-4 h-4 mr-1">
                            <svg class="animate-spin h-4 w-4 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                          </span>
                          {{ 'project.list.restore' | translate }}<span class="sr-only">, {{ project.name }}</span>
                        </button>
                        <button
                          class="text-tertiary hover:text-tertiary-light"
                          [disabled]="isProjectBeingRestored(project.uuid) || isProjectBeingDeleted(project.uuid)"
                          (click)="$event.stopPropagation(); deleteProject(project.uuid)"
                        >
                          <span *ngIf="isProjectBeingDeleted(project.uuid)" class="inline-block w-4 h-4 mr-1">
                            <svg class="animate-spin h-4 w-4 text-tertiary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                          </span>
                          {{ 'project.list.delete.permanently' | translate }}<span class="sr-only">, {{ project.name }}</span>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && projectsService.projectsInTrash().length > 0" class="mt-4 flex justify-end">
        <button (click)="refreshProjects()" class="btn btn-small btn-muted">
          {{ 'project.list.refresh' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<app-confirmation-dialog
  [isOpen]="isConfirmRestoreOpen"
  [title]="'project.list.restore.project' | translate"
  [message]="'project.list.restore.project.description' | translate"
  [confirmText]="'project.list.restore' | translate"
  [cancelText]="'project.list.cancel' | translate"
  (close)="closeRestoreConfirmation()"
  (confirm)="confirmRestore()"
></app-confirmation-dialog>

<app-confirmation-dialog
  [isOpen]="isConfirmDeleteOpen"
  [title]="'project.list.delete.permanently.project' | translate"
  [message]="'project.list.delete.permanently.project.description' | translate"
  [confirmText]="'project.list.delete.permanently' | translate"
  [cancelText]="'project.list.cancel' | translate"
  (close)="closeDeleteConfirmation()"
  (confirm)="confirmDelete()"
></app-confirmation-dialog>

<app-confirmation-dialog
  [isOpen]="isConfirmBulkRestoreOpen"
  [title]="'project.list.restore.projects' | translate"
  [message]="'project.list.restore.projects.description' | translate"
  [confirmText]="'project.list.restore' | translate"
  [cancelText]="'project.list.cancel' | translate"
  (close)="closeBulkRestoreConfirmation()"
  (confirm)="confirmBulkRestore()"
></app-confirmation-dialog>

<app-confirmation-dialog
  [isOpen]="isConfirmBulkDeleteOpen"
  [title]="'project.list.delete.permanently.projects' | translate"
  [message]="'project.list.delete.permanently.projects.description' | translate"
  [confirmText]="'project.list.delete.permanently' | translate"
  [cancelText]="'project.list.cancel' | translate"
  (close)="closeBulkDeleteConfirmation()"
  (confirm)="confirmBulkDelete()"
></app-confirmation-dialog> 